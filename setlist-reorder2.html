<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Band Setlist Arranger</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Sortable/1.15.0/Sortable.min.js"></script>
    <style>
        .drag-ghost { opacity: 0.4; background: #ebf8ff; border: 2px dashed #4299e1; }
        .drag-chosen { background: #f7fafc; box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1); }
    </style>
</head>
<body class="bg-gray-100 min-h-screen p-4 md:p-8">

    <div class="max-w-5xl mx-auto">
        <header class="mb-8 text-center">
            <h1 class="text-3xl font-bold text-gray-800">Band Setlist Arranger</h1>
            <p class="text-gray-600 mt-2">Upload your CSV, drag to reorder, and prep your show.</p>
        </header>

        <div class="bg-white p-6 rounded-lg shadow-md mb-6 border-2 border-dashed border-blue-300">
            <label class="block text-sm font-medium text-gray-700 mb-2">Upload CSV File</label>
            <input type="file" id="csvFile" accept=".csv" 
                   class="block w-full text-sm text-gray-500 file:mr-4 file:py-2 file:px-4 file:rounded-full file:border-0 file:text-sm file:font-semibold file:bg-blue-50 file:text-blue-700 hover:file:bg-blue-100 cursor-pointer">
        </div>

        <div class="bg-white rounded-lg shadow-lg overflow-hidden">
            <table class="min-w-full divide-y divide-gray-200">
                <thead class="bg-gray-50">
                    <tr id="tableHeader">
                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Order</th>
                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Orig. #</th>
                        </tr>
                </thead>
                <tbody id="setlistBody" class="bg-white divide-y divide-gray-200 cursor-move">
                    </tbody>
            </table>
        </div>
        
        <div id="emptyState" class="text-center py-12 text-gray-400">
            No songs loaded yet. Upload a CSV to get started.
        </div>
    </div>

    <script>
        const fileInput = document.getElementById('csvFile');
        const tableBody = document.getElementById('setlistBody');
        const tableHeader = document.getElementById('tableHeader');
        const emptyState = document.getElementById('emptyState');

        // Initialize SortableJS
        const sortable = new Sortable(tableBody, {
            animation: 150,
            ghostClass: 'drag-ghost',
            chosenClass: 'drag-chosen',
            onEnd: function() {
                updateCurrentOrder();
            }
        });

        fileInput.addEventListener('change', function(e) {
            const file = e.target.files[0];
            if (!file) return;

            const reader = new FileReader();
            reader.onload = function(event) {
                processCSV(event.target.result);
            };
            reader.readAsText(file);
        });

        function processCSV(csvText) {
            const lines = csvText.split(/\r?\n/);
            if (lines.length === 0) return;

            // Clear previous data
            tableBody.innerHTML = '';
            const headers = lines[0].split(',');
            
            // Build Headers (keeping your specific order requirements)
            tableHeader.innerHTML = `
                <th class="px-4 py-3 text-left text-xs font-bold text-blue-600 uppercase">Set Order</th>
                <th class="px-4 py-3 text-left text-xs font-bold text-gray-500 uppercase">Orig. Row</th>
                ${headers.map(h => `<th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase">${h}</th>`).join('')}
            `;

            // Build Rows
            let rowCount = 0;
            for (let i = 1; i < lines.length; i++) {
                if (lines[i].trim() === '') continue;
                rowCount++;
                
                const cells = lines[i].split(',');
                const row = document.createElement('tr');
                row.className = "hover:bg-blue-50 transition-colors";
                
                row.innerHTML = `
                    <td class="px-4 py-4 whitespace-nowrap text-sm font-bold text-blue-600 current-idx">${rowCount}</td>
                    <td class="px-4 py-4 whitespace-nowrap text-sm text-gray-400">${i + 1}</td>
                    ${cells.map(c => `<td class="px-4 py-4 whitespace-nowrap text-sm text-gray-900">${c}</td>`).join('')}
                `;
                tableBody.appendChild(row);
            }

            emptyState.classList.add('hidden');
            updateCurrentOrder();
        }

        function updateCurrentOrder() {
            const rows = tableBody.querySelectorAll('tr');
            rows.forEach((row, index) => {
                row.querySelector('.current-idx').textContent = index + 1;
            });
        }
    </script>
</body>
</html>